---
import background from "../assets/background.svg";
import {
	quickPrompts,
	conversationFlow,
	getFeaturedEnterprises,
	getSummaryStats,
	buildSynergyNarrative,
	buildSynergyBadges,
} from "../data/enterprises";

const featuredEnterprises = getFeaturedEnterprises(3);
const stats = getSummaryStats();
const summaryNumberFormatter = new Intl.NumberFormat("zh-CN", {
	notation: "compact",
	maximumFractionDigits: 1,
});
const summaryCards = [
	{
		label: "实时企业覆盖",
		value: summaryNumberFormatter.format(stats.enterpriseCoverage),
		suffix: "+",
	},
	{
		label: "服务能力标签",
		value: stats.capabilityTags.toLocaleString("zh-CN"),
		suffix: "+",
	},
	{
		label: "平均响应时间",
		value: stats.avgResponseSeconds.toFixed(1),
		suffix: "s",
	},
];
const synergyNarrative = buildSynergyNarrative(featuredEnterprises);
const synergyBadges = buildSynergyBadges(featuredEnterprises);
const badgeToneClassMap: Record<string, string> = {
	emerald: "bg-emerald-500/10 text-emerald-200",
	pink: "bg-pink-500/10 text-pink-200",
	indigo: "bg-indigo-500/10 text-indigo-200",
};
---

<div class="relative min-h-screen font-sans text-white overflow-hidden bg-slate-950">
	<img
		class="absolute inset-0 w-full h-full object-cover opacity-30 blur-[140px]"
		src={background.src}
		alt=""
		fetchpriority="high"
	/>
	<div class="absolute inset-x-0 top-0 h-[520px] bg-gradient-to-b from-[#030712] via-[#0f172a] to-transparent opacity-90"></div>
	<div class="absolute -bottom-32 -right-32 w-[480px] h-[480px] bg-purple-600/40 blur-[220px] rounded-full"></div>

	<main class="relative z-10 px-6 py-10 md:px-12 lg:px-24">
		<section class="min-h-[70vh] flex flex-col items-center justify-center text-center gap-8">
			<span class="inline-flex items-center gap-2 px-4 py-1.5 text-xs uppercase tracking-[0.35em] text-slate-200 bg-white/10 rounded-full border border-white/10">
				X-Search · 企业知识图谱
			</span>

			<div class="w-full max-w-4xl">
				<div class="rounded-[32px] border border-white/10 bg-gradient-to-br from-white/10 via-white/5 to-transparent backdrop-blur-3xl p-6 sm:p-8 space-y-6 shadow-[0_35px_85px_rgba(15,23,42,0.65)]">
					<div class="space-y-2">
						<h2 class="text-2xl font-semibold">通过对话式搜索，瞬间洞察企业信息与服务网络</h2>
					</div>
					<div class="flex flex-col gap-4 md:flex-row md:items-center">
						<input
							class="flex-1 rounded-2xl bg-white/10 border border-white/15 px-5 py-4 text-base text-white placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-400/60"
							placeholder="例如：南山区可承担 5000 万级 EPC 的新能源企业"
						/>
						<button class="w-full md:w-auto px-6 py-4 rounded-2xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 font-medium text-white shadow-[0_25px_45px_rgba(99,102,241,0.35)]">
							开启对话
						</button>
					</div>
					<div class="flex flex-wrap justify-center gap-3">
						{quickPrompts.map((prompt) => (
							<button class="px-4 py-2 rounded-full bg-white/10 border border-white/10 text-sm text-slate-100 hover:bg-white/20 transition-colors">
								{prompt}
							</button>
						))}
					</div>
				</div>
			</div>
		</section>

		<section class="pt-16 pb-20 space-y-12 border-t border-white/10">
			<div class="grid gap-8 lg:grid-cols-[1.2fr,0.8fr] items-start">
				<div class="rounded-[32px] border border-white/10 bg-white/5 backdrop-blur-3xl p-6 lg:p-8 space-y-6 shadow-[0_45px_95px_rgba(15,23,42,0.45)]">
					<header class="flex flex-col gap-2 text-left">
						<p class="text-xs uppercase tracking-[0.3em] text-slate-300">
							实时对话
						</p>
						<div class="flex items-center justify-between gap-4">
							<h3 class="text-2xl font-semibold">企业洞察现场</h3>
							<span class="text-xs text-emerald-300 bg-emerald-500/10 border border-emerald-400/20 px-3 py-1 rounded-full">
								在线
							</span>
						</div>
					</header>
					<div class="space-y-4">
						{conversationFlow.map(({ role, title, message, highlights }) => (
							<div class={`rounded-2xl p-5 border ${role === "user" ? "bg-white/5 border-white/10" : "bg-gradient-to-br from-white/15 via-white/5 to-transparent border-white/20"}`}>
								<p class="text-xs uppercase tracking-[0.4em] text-slate-300">
									{title}
								</p>
								<p class="text-base leading-6 mt-2 text-slate-100">
									{message}
								</p>
								{highlights && (
									<ul class="mt-3 space-y-1 text-sm text-emerald-200">
										{highlights.map((item) => (
											<li>· {item}</li>
										))}
									</ul>
								)}
							</div>
						))}
					</div>
					<div class="rounded-2xl border border-dashed border-white/20 p-4 flex flex-wrap items-center gap-3">
						<div class="flex-1 text-sm text-slate-300">
							输入任意问题，系统即刻串联工商、投融资与项目交付数据。
						</div>
						<button class="px-4 py-2 rounded-xl bg-white/90 text-slate-900 font-medium">
							继续提问
						</button>
					</div>
				</div>

				<div class="space-y-6">
					<div class="grid gap-4 sm:grid-cols-3">
						{summaryCards.map((card) => (
							<div class="rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl p-4 text-left">
								<p class="text-xs uppercase tracking-[0.35em] text-slate-300">
									{card.label}
								</p>
								<p class="text-3xl font-semibold mt-2">
									{card.value}
									{card.suffix && (
										<span class="text-lg font-medium align-top ml-0.5">{card.suffix}</span>
									)}
								</p>
							</div>
						))}
					</div>
					<div class="rounded-3xl border border-white/10 bg-white/5 backdrop-blur-2xl p-6 space-y-4">
						<p class="text-xs uppercase tracking-[0.3em] text-slate-300">协同建议</p>
						<p class="text-lg text-slate-100">
							{synergyNarrative}
						</p>
						<div class="flex flex-wrap gap-3">
							{synergyBadges.map((badge) => (
								<span class={`px-3 py-1 rounded-full text-xs ${badgeToneClassMap[badge.tone] ?? "bg-white/10 text-slate-100"}`}>
									{badge.label}
								</span>
							))}
						</div>
					</div>
				</div>
			</div>

			<div class="space-y-6">
				<header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
					<div>
						<p class="text-xs uppercase tracking-[0.35em] text-slate-300">
							可立即沟通的企业
						</p>
						<h3 class="text-3xl font-semibold mt-2">
							核心服务商一览
						</h3>
					</div>
					<button class="px-5 py-3 rounded-2xl bg-white text-slate-900 font-medium">
						预约定制洞察
					</button>
				</header>

				<div class="grid gap-6 lg:grid-cols-3">
					{featuredEnterprises.map((enterprise) => (
						<div class="rounded-[28px] border border-white/10 bg-white/5 backdrop-blur-2xl p-6 flex flex-col gap-4">
							<div>
								<p class="text-sm uppercase tracking-[0.3em] text-slate-300">
									{enterprise.location}
								</p>
								<h4 class="text-2xl font-semibold mt-1">
									{enterprise.name}
								</h4>
							</div>
							<p class="text-sm text-slate-200 leading-relaxed">
								{enterprise.summary}
							</p>
							<div class="flex flex-wrap gap-2">
								{enterprise.services.map((service) => (
									<span class="px-3 py-1 rounded-full bg-white/10 border border-white/10 text-xs text-slate-100">
										{service}
									</span>
								))}
							</div>
							<button class="mt-auto w-full rounded-2xl border border-white/20 bg-white/10 py-3 text-sm font-medium text-white hover:bg-white/20 transition-colors">
								发送对接请求
							</button>
						</div>
					))}
				</div>
			</div>
		</section>
	</main>
</div>
